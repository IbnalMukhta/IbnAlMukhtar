<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ© - Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <link rel="icon" type="image/png" sizes="32x32" href="/images/icon-32x32.png">
    
    <style>
        :root {
            --main-color: #001F3F;
            --secondary-color: #FF8C00;
            --bg-color: #ffffff;
            --card-bg: #ffffff;
            --text-color: #001F3F;
            --radius: 12px;
            --danger: #ff4d4d;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            margin: 0;
            font-family: 'Tajawal', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 15px;
            padding-bottom: 100px;
        }

        /* Header */
        .product-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }

        .back-btn {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--main-color);
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-btn:hover {
            background: #f5f5f5;
        }

        .product-header h1 {
            margin: 0;
            font-size: 24px;
            color: var(--main-color);
            flex: 1;
        }

        /* Image Gallery - ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù„Ø¥Ø¶Ø§ÙØ© Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø´Ø±ÙŠØ­Ø© (Carousel) */
        .product-image-gallery {
            position: relative;
            width: 100%;
            margin-bottom: 20px;
            border-radius: var(--radius);
            overflow: hidden;
            background: #fff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .main-product-image {
            width: 100%;
            padding-top: 100%; /* Ù†Ø³Ø¨Ø© 1:1 Ù„Ù„ØµÙˆØ± */
            position: relative;
            background: #f8f9fa;
            overflow: hidden; /* Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙˆØ± ØºÙŠØ± Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© */
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± Ù„ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ Ø¨ÙˆØ§Ø³Ø·Ø© Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª */
        .image-carousel {
            position: absolute;
            inset: 0;
            display: flex; /* Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø¬Ù†Ø¨Ø§Ù‹ Ø¥Ù„Ù‰ Ø¬Ù†Ø¨ */
            transition: transform 0.3s ease-in-out; /* Ø­Ø±ÙƒØ© Ø³Ù„Ø³Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ†Ù‚Ù„ */
        }
        
        .carousel-item {
            min-width: 100%; /* ÙƒÙ„ ØµÙˆØ±Ø© ØªØ£Ø®Ø° Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
            height: 100%;
            position: relative;
            flex-shrink: 0; /* Ù„Ù…Ù†Ø¹ ØªÙ‚Ù„Øµ Ø§Ù„ØµÙˆØ± */
        }

        .carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 20px;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ */
        .carousel-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            z-index: 10;
            font-size: 24px;
            line-height: 1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .carousel-nav-btn:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .prev-btn {
            right: 10px; /* Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©: Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙŠÙƒÙˆÙ† ÙŠÙ…ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© */
        }

        .next-btn {
            left: 10px; /* Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©: Ø§Ù„Ø³Ù‡Ù… Ø§Ù„ØªØ§Ù„ÙŠ ÙŠÙƒÙˆÙ† ÙŠØ³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø© */
        }

        /* Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØµØºØ±Ø© */
        .image-thumbnails {
            display: flex;
            gap: 10px;
            padding: 10px;
            overflow-x: auto;
            background: #fff;
            border-top: 1px solid #eee;
        }

        .image-thumbnail {
            width: 70px;
            height: 70px;
            flex-shrink: 0;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            background: #f8f9fa;
            transition: border-color 0.2s;
        }

        .image-thumbnail.active {
            border-color: var(--secondary-color);
        }

        .image-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Product Info */
        .product-info {
            background: #fff;
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .product-price-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: var(--radius);
            border: 1px solid #eee;
        }

        .current-price {
            font-size: 28px;
            font-weight: 800;
            color: var(--secondary-color);
        }

        .old-price {
            font-size: 18px;
            color: #999;
            text-decoration: line-through;
        }

        .currency {
            font-size: 16px;
            font-weight: 700;
            color: var(--secondary-color);
        }

        .discount-badge {
            background: var(--danger);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
        }

        .product-description {
            line-height: 1.6;
            color: #555;
            margin-bottom: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: var(--radius);
        }

        .product-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: var(--radius);
        }

        .meta-item i {
            color: var(--secondary-color);
            font-size: 18px;
        }

        /* Actions */
        .product-actions {
            position: sticky;
            bottom: 20px;
            background: #fff;
            padding: 15px;
            border-radius: var(--radius);
            box-shadow: 0 -4px 15px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .add-to-cart-btn {
            flex: 2;
            padding: 15px;
            background: var(--main-color);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .whatsapp-btn {
            flex: 1;
            padding: 15px;
            background: #25D366;
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .view-similar-btn {
            width: 100%;
            padding: 12px;
            background: #f0f0f0;
            color: var(--main-color);
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            margin-top: 10px;
            cursor: pointer;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid #eee;
            z-index: 100;
            height: 60px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            color: #ccc;
            font-size: 10px;
            font-weight: 500;
            width: 50%;
            padding: 6px 0;
            cursor: pointer;
            text-decoration: none;
        }

        .nav-item.active {
            color: var(--secondary-color);
            font-weight: 700;
        }

        @media (min-width: 768px) {
            .container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
                padding-top: 30px;
            }
            
            .product-image-gallery {
                grid-column: 1;
                margin-bottom: 0;
            }
            
            .product-info {
                grid-column: 2;
                align-self: start;
                margin-bottom: 0;
            }
            
            .product-actions {
                position: static;
                grid-column: 2;
                box-shadow: none;
                margin-top: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="loading" id="loading">
            Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬...
        </div>
        
        <div id="productContent" style="display: none;">
            <div class="product-header">
                <button class="back-btn" onclick="goBack()">â†</button>
                <h1 id="productTitle">...</h1>
            </div>
            
            <div class="product-image-gallery">
                <div class="main-product-image">
                    <div class="image-carousel" id="imageCarousel">
                        </div>
                    
                    <button class="carousel-nav-btn prev-btn" onclick="navigateCarousel(-1)">â®</button>
                    <button class="carousel-nav-btn next-btn" onclick="navigateCarousel(1)">â¯</button>
                </div>
                
                <div class="image-thumbnails" id="imageThumbnails">
                    </div>
            </div>
            
            <div class="product-info">
                <div class="product-price-section">
                    <div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span class="current-price" id="currentPrice">0</span>
                            <span class="currency" id="currency">Ø±.ÙŠ</span>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px; margin-top:5px;">
                            <span class="old-price" id="oldPrice">0 Ø±.ÙŠ</span>
                            <span class="discount-badge" id="discountBadge">Ø®ØµÙ… 0%</span>
                        </div>
                    </div>
                </div>
                
                <div class="product-description">
                    <h3 style="margin-top:0; color:var(--main-color)">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h3>
                    <p id="productDescription">...</p>
                </div>
                
                <div class="product-meta" id="productMeta">
                    </div>
            </div>
            
            <div class="product-actions">
                <div class="action-buttons">
                    <button class="add-to-cart-btn" onclick="addToCart()">
                        ğŸ›’ Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
                    </button>
                    <button class="whatsapp-btn" onclick="shareOnWhatsApp()">
                        ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨
                    </button>
                </div>
                <button class="view-similar-btn" onclick="viewSimilar()">
                    ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ù†ØªØ¬Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©
                </button>
            </div>
        </div>
    </div>
    
    <div class="bottom-nav">
        <a href="index.html" class="nav-item">
            <svg viewBox="0 0 24 24" width="22" height="22"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" fill="currentColor"/></svg>
            <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </a>
        <a href="index.html?tab=cart" class="nav-item">
            <svg viewBox="0 0 24 24" width="22" height="22"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" fill="currentColor"/></svg>
            <span>Ø§Ù„Ø³Ù„Ø©</span>
        </a>
    </div>

    <script>
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        
        let productData = null;
        const SAR_RATE = 140;
        let currentCurrency = localStorage.getItem('currentCurrency') || 'YER';
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø´Ø±ÙŠØ­Ø© (Carousel)
        let currentImageIndex = 0; // Ù…Ø¤Ø´Ø± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        let productImages = []; // Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¬Ù…ÙŠØ¹ ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬

        async function loadProduct() {
            if (!productId) {
                document.getElementById('loading').innerHTML = 'âŒ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
                return;
            }
            
            try {
                // Ù‡Ø°Ø§ Ù…Ø«Ø§Ù„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©ØŒ ÙŠØ¬Ø¨ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                const storedProducts = localStorage.getItem('allProducts');
                let products = [];
                
                if (storedProducts) {
                    products = JSON.parse(storedProducts);
                    productData = products.find(p => p.id == productId);
                }
                
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬ØŒ Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„Ù…Ø¹Ø±Ø¶
                if (!productData) {
                    productData = {
                        id: productId,
                        name: 'Ø·Ù‚Ù… Ø£Ø¯ÙˆØ§Øª Ù…Ø·Ø¨Ø® Ø¹ØµØ±ÙŠ',
                        price: 35000,
                        description: 'Ø·Ù‚Ù… Ù…ØªÙƒØ§Ù…Ù„ ÙˆØ¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© Ù…ØµÙ†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø³ØªØ§Ù†Ù„Ø³ Ø³ØªÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ… Ù„Ù„ØµØ¯Ø£. ØªØµÙ…ÙŠÙ… Ø£Ù†ÙŠÙ‚ ÙˆØ¹Ù…Ù„ÙŠ ÙŠÙ„Ø¨ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ù…Ø·Ø¨Ø®Ùƒ Ø§Ù„Ø­Ø¯ÙŠØ«. ÙŠØªØ¶Ù…Ù† Ø¶Ù…Ø§Ù† Ù„Ù…Ø¯Ø© Ø¹Ø§Ù… ÙƒØ§Ù…Ù„.',
                        category: 'Ù…Ø·Ø¨Ø®',
                        // Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ù…Ù‡Ù… Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø¹Ø±Ø¶
                        image: [
                            'https://picsum.photos/id/111/800/800', // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
                            'https://picsum.photos/id/112/800/800', // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
                            'https://picsum.photos/id/113/800/800', // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©
                            'https://picsum.photos/id/114/800/800', // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©
                        ]
                    };
                }
         
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                setTimeout(() => {
                    displayProduct(productData);
                }, 500);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬:', error);
                document.getElementById('loading').innerHTML = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬';
            }
        }
        
        function displayProduct(product) {
            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            document.getElementById('loading').style.display = 'none';
            document.getElementById('productContent').style.display = 'block';
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            document.getElementById('productTitle').textContent = product.name || 'Ù…Ù†ØªØ¬';
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙˆØ± (Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±)
            productImages = Array.isArray(product.image) ? product.image : [product.image || ''];
            const carouselContainer = document.getElementById('imageCarousel');
            const thumbnailsContainer = document.getElementById('imageThumbnails');
            
            // 1. Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ø±ÙŠØ­Ø© (Carousel Items)
            carouselContainer.innerHTML = '';
            productImages.forEach((img, index) => {
                if (img) {
                    const carouselItem = document.createElement('div');
                    carouselItem.className = 'carousel-item';
                    carouselItem.innerHTML = `<img src="${img}" alt="${product.name} - ØµÙˆØ±Ø© ${index + 1}">`;
                    carouselContainer.appendChild(carouselItem);
                }
            });

            // 2. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØµØºØ±Ø© (Thumbnails)
            thumbnailsContainer.innerHTML = '';
            productImages.forEach((img, index) => {
                if (img) {
                    const thumbnail = document.createElement('div');
                    thumbnail.className = `image-thumbnail ${index === 0 ? 'active' : ''}`;
                    thumbnail.onclick = () => {
                        showImage(index); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                    };
                    
                    thumbnail.innerHTML = `<img src="${img}" alt="${product.name} - ØµÙˆØ±Ø© ${index + 1}">`;
                    thumbnailsContainer.appendChild(thumbnail);
                }
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            showImage(0); 
            
            // Ø§Ù„Ø³Ø¹Ø±
            updatePrices(product.price || 0);
            
            // Ø§Ù„ÙˆØµÙ
            document.getElementById('productDescription').textContent = 
                product.description || "Ù…Ù†ØªØ¬ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© Ù…Ù† Ù…ØªØ¬Ø± Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©. ÙŠØªÙ…ÙŠØ² Ø¨Ø§Ù„Ù…ØªØ§Ù†Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¹Ø§Ù„ÙŠØ© Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø§Ù„Ø¬ÙˆØ¯Ø©.";
            
            // Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
            const metaContainer = document.getElementById('productMeta');
            const hash = Math.abs(product.id.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0));
            const soldCount = (hash % 901) + 100;
            const inStock = (hash % 100) > 10;
            
            metaContainer.innerHTML = `
                <div class="meta-item">
                    <i>ğŸ“¦</i>
                    <div>
                        <div style="font-weight:700; color:var(--main-color)">Ø§Ù„ØªÙˆÙØ±</div>
                        <div style="color:${inStock ? 'green' : 'red'}">${inStock ? 'Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†' : 'ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹'}</div>
                    </div>
                </div>
                <div class="meta-item">
                    <i>ğŸ”¥</i>
                    <div>
                        <div style="font-weight:700; color:var(--main-color)">Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                        <div>ØªÙ… Ø¨ÙŠØ¹ ${soldCount}+ Ù‚Ø·Ø¹Ø©</div>
                    </div>
                </div>
                ${product.category ? `
                <div class="meta-item">
                    <i>ğŸ·ï¸</i>
                    <div>
                        <div style="font-weight:700; color:var(--main-color)">Ø§Ù„ØªØµÙ†ÙŠÙ</div>
                        <div>${product.category}</div>
                    </div>
                </div>
                ` : ''}
            `;
            
            // Ø­ÙØ¸ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ localStorage Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰
            localStorage.setItem('currentProduct', JSON.stringify(product));
        }

        /**
         * Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ­Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØºØ±Ø© Ø§Ù„Ù†Ø´Ø·Ø©
         * @param {number} index - Ù…Ø¤Ø´Ø± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¹Ø±Ø¶Ù‡Ø§
         */
        function showImage(index) {
            if (productImages.length === 0) return;

            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø¤Ø´Ø± Ø¶Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ (Ø­Ù„Ù‚Ø© Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ©)
            if (index >= productImages.length) {
                index = 0;
            } else if (index < 0) {
                index = productImages.length - 1;
            }

            currentImageIndex = index;

            const carousel = document.getElementById('imageCarousel');
            const thumbnailElements = document.querySelectorAll('.image-thumbnail');

            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø´Ø±ÙŠØ­Ø©: (Ù†Ø¶Ø±Ø¨ ÙÙŠ -100% Ù„Ø£Ù† Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¹Ø±Ø¨ÙŠ R-T-L)
            const offset = -currentImageIndex * 100;
            carousel.style.transform = `translateX(${offset}%)`;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØºØ±Ø© Ø§Ù„Ù†Ø´Ø·Ø©
            thumbnailElements.forEach((t, i) => {
                t.classList.toggle('active', i === currentImageIndex);
                if (i === currentImageIndex) {
                    // ØªÙ…Ø±ÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØºØ±Ø© Ø§Ù„Ù†Ø´Ø·Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¶
                    t.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                }
            });
        }
        
        /**
         * Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙˆØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø£Ø³Ù‡Ù…
         * @param {number} direction - 1 Ù„Ù„ØªØ§Ù„ÙŠØŒ -1 Ù„Ù„Ø³Ø§Ø¨Ù‚
         */
        function navigateCarousel(direction) {
            showImage(currentImageIndex + direction);
        }
        
        function updatePrices(price) {
            let priceVal = parseFloat(price) || 0;
            let fakeOldPrice = Math.floor(priceVal * 1.3);
            let discountPercent = Math.round((1 - (priceVal / fakeOldPrice)) * 100);
            
            let displayPrice = priceVal;
            let displayOld = fakeOldPrice;
            let displayCurrency = 'Ø±.ÙŠ';
            
            if (currentCurrency === 'SAR') {
                displayPrice = Math.ceil(priceVal / SAR_RATE);
                displayOld = Math.ceil(fakeOldPrice / SAR_RATE);
                displayCurrency = 'Ø±.Ø³';
            }
            
            document.getElementById('currentPrice').textContent = displayPrice.toLocaleString();
            document.getElementById('currency').textContent = displayCurrency;
            document.getElementById('oldPrice').textContent = displayOld.toLocaleString() + ' ' + displayCurrency;
            document.getElementById('discountBadge').textContent = `Ø®ØµÙ… ${discountPercent}%`;
        }
        
        function addToCart() {
            if (!productData) return;
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ø³Ù„Ø©
            const existingItem = cart.find(item => item.id === productData.id);
            
            if (existingItem) {
                existingItem.qty += 1;
            } else {
                cart.push({
                    id: productData.id,
                    name: productData.name,
                    price: productData.price,
                    qty: 1
                });
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø©
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        }
        
        function shareOnWhatsApp() {
            if (!productData) return;
            
            const price = parseFloat(productData.price) || 0;
            const displayPrice = currentCurrency === 'SAR' 
                ? Math.ceil(price / SAR_RATE).toLocaleString() + ' Ø±.Ø³'
                : price.toLocaleString() + ' Ø±.ÙŠ';
            
            const message = `ğŸ“¦ *${productData.name}*\n\nğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${displayPrice}\n\nğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬:\n${window.location.href}`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }
        
        function viewSimilar() {
            if (!productData || !productData.category) return;
            
            // Ø­ÙØ¸ Ø§Ù„ØªØµÙ†ÙŠÙ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            localStorage.setItem('filterCategory', productData.category);
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ø¹ Ø§Ù„ØªØµÙÙŠØ©
            window.location.href = 'index.html?filter=' + encodeURIComponent(productData.category);
        }
        
        function goBack() {
            // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø£Ùˆ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            if (document.referrer && document.referrer.includes(window.location.hostname)) {
                window.history.back();
            } else {
                window.location.href = 'index.html';
            }
        }
        
        function showMessage(text) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--secondary-color);
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                font-weight: 700;
                z-index: 10000;
                box-shadow: 0 4px 15px rgba(255,140,0,0.3);
                animation: fadeInOut 3s ease;
            `;
            
            message.textContent = text;
            document.body.appendChild(message);
            
            // Ø¥Ø¶Ø§ÙØ© animation Ù„Ù„CSS
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                    10% { opacity: 1; transform: translateX(-50%) translateY(0); }
                    90% { opacity: 1; transform: translateX(-50%) translateY(0); }
                    100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                }
            `;
            document.head.appendChild(style);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                message.remove();
                style.remove();
            }, 3000);
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', loadProduct);
        
        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
        window.addEventListener('popstate', function() {
            goBack();
        });
    </script>
</body>
</html>
