<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    
    <title id="metaTitle">Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± - Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬</title>
    <meta name="description" id="metaDescription" content="Ù…ØªØ¬Ø± Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± - Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©">
    <meta property="og:title" id="ogTitle" content="Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø±">
    <meta property="og:image" id="ogImage" content="logo.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* =========================================
           1. Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª (Variables)
           ========================================= */
        :root {
            --main-color: #001F3F; /* ÙƒØ­Ù„ÙŠ Ù…Ù„ÙƒÙŠ */
            --secondary-color: #FF8C00; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
            --sar-color: #28a745; /* Ø£Ø®Ø¶Ø± Ù„Ù„Ø±ÙŠØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ */
            --danger-color: #dc3545;
            --bg-color: #f4f7f9;
            --card-bg: #ffffff;
            --radius-lg: 25px;
            --radius-md: 15px;
            --shadow: 0 10px 40px rgba(0,0,0,0.06);
            --transition: all 0.3s ease;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            outline: none; 
        }
        
        body { 
            margin: 0; 
            font-family: 'Tajawal', sans-serif; 
            background: var(--bg-color); 
            color: var(--main-color); 
            padding-bottom: 140px;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container { max-width: 850px; margin: 0 auto; padding: 15px; }

        /* =========================================
           2. Ø§Ù„Ù‡ÙŠØ¯Ø± (Top Bar)
           ========================================= */
        .top-actions-bar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px;
            position: sticky;
            top: 10px;
            z-index: 1000;
        }

        .back-btn-glow {
            text-decoration: none; background: var(--main-color); color: #fff;
            padding: 12px 25px; border-radius: 50px; display: inline-flex; align-items: center; gap: 10px;
            font-weight: 700; border: 1px solid var(--secondary-color);
            box-shadow: 0 8px 20px rgba(0, 31, 63, 0.25);
            font-size: 14px; transition: var(--transition);
        }
        .back-btn-glow:hover { transform: scale(1.05); background: #002d5c; }

        .top-share-btn {
            background: #fff; color: var(--main-color); border: 1px solid #eee;
            width: 48px; height: 48px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; 
            font-size: 18px; cursor: pointer; transition: var(--transition);
            box-shadow: var(--shadow);
        }
        .top-share-btn:hover { background: var(--secondary-color); color: #fff; transform: rotate(-15deg); }

        /* =========================================
           3. Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± (Gallery)
           ========================================= */
        .gallery-wrapper { 
            background: var(--card-bg); 
            border-radius: var(--radius-lg); 
            padding: 12px; 
            box-shadow: var(--shadow); 
            margin-bottom: 25px; 
            position: relative;
            overflow: hidden;
        }

        /* Ù…Ù„ØµÙ‚ Ù†ÙØ§Ø¯ Ø§Ù„ÙƒÙ…ÙŠØ© */
        .out-of-stock-ribbon {
            position: absolute;
            top: 30px;
            right: -40px;
            background: var(--danger-color);
            color: white;
            padding: 10px 50px;
            transform: rotate(45deg);
            font-weight: 800;
            font-size: 14px;
            z-index: 50;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: none;
        }

        .product-out-of-stock img {
            filter: grayscale(0.8) contrast(0.8);
            opacity: 0.7;
        }

        .main-image-container { 
            width: 100%; 
            aspect-ratio: 1/1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden; 
            border-radius: var(--radius-md); 
            background: #fff; 
        }
        .main-image-container img { width: 100%; height: 100%; object-fit: contain; transition: transform 0.6s cubic-bezier(0.165, 0.84, 0.44, 1); }

        .thumbnails-grid { 
            display: flex; 
            gap: 12px; 
            margin-top: 15px; 
            overflow-x: auto; 
            padding: 5px 2px 10px; 
            scrollbar-width: none; 
        }
        .thumbnails-grid::-webkit-scrollbar { display: none; }
        .thumb-item { 
            width: 75px; height: 75px; flex-shrink: 0; border-radius: 12px; 
            cursor: pointer; border: 2.5px solid transparent; overflow: hidden; 
            background: #f9f9f9; transition: var(--transition); 
        }
        .thumb-item img { width: 100%; height: 100%; object-fit: cover; }
        .thumb-item.active { border-color: var(--secondary-color); transform: scale(1.1); box-shadow: 0 5px 15px rgba(255,140,0,0.2); }

        /* =========================================
           4. Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (Product Info)
           ========================================= */
        .info-card { 
            background: var(--card-bg); 
            padding: 25px; 
            border-radius: var(--radius-lg); 
            margin-bottom: 20px; 
            box-shadow: var(--shadow); 
        }
        
        .product-title { 
            font-size: 26px; 
            font-weight: 800; 
            margin: 0 0 10px 0; 
            color: var(--main-color); 
            line-height: 1.3;
        }

        .category-badge {
            display: inline-block;
            background: rgba(0, 31, 63, 0.05);
            color: var(--main-color);
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .price-row { 
            display: flex; 
            align-items: center; 
            gap: 20px; 
            margin: 20px 0; 
            padding: 15px; 
            background: #fafafa; 
            border-radius: 20px; 
            border: 1px solid #f0f0f0; 
        }
        .price-box { display: flex; flex-direction: column; }
        .price-yer { font-size: 32px; font-weight: 900; color: var(--secondary-color); letter-spacing: -1px; }
        .price-sar { font-size: 22px; font-weight: 700; color: var(--sar-color); }
        .currency-label { font-size: 11px; font-weight: 700; color: #aaa; margin-top: -2px; }
        .divider-v { width: 1.5px; height: 45px; background: #eee; }

        /* Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª */
        .section-header { 
            font-weight: 800; 
            font-size: 17px; 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .section-header i { color: var(--secondary-color); width: 20px; }
        
        .sizes-flex { display: flex; flex-wrap: wrap; gap: 12px; }
        .size-pill { 
            background: #fff; border: 2px solid #f0f0f0; border-radius: 18px; padding: 12px 18px; 
            text-align: center; cursor: pointer; transition: var(--transition); min-width: 110px;
            display: flex; flex-direction: column;
        }
        .size-pill strong { font-size: 15px; }
        .size-pill span { font-size: 12px; color: #777; margin-top: 2px; }
        .size-pill.active { 
            border-color: var(--secondary-color); 
            background: #fffaf5; 
            transform: translateY(-3px); 
            box-shadow: 0 5px 15px rgba(255,140,0,0.1);
        }

        /* Ø§Ù„ÙˆØµÙ */
        .desc-content { color: #4a4a4a; line-height: 1.9; white-space: pre-line; font-size: 15.5px; }

        /* =========================================
           5. Ù‚Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡Ø© (Similar Products)
           ========================================= */
        .similar-section { margin: 30px 0 10px; }
        
        .similar-scroll {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 5px 20px;
            scrollbar-width: none;
        }
        .similar-scroll::-webkit-scrollbar { display: none; }

        .similar-card {
            flex: 0 0 160px;
            background: #fff;
            border-radius: 20px;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.04);
            text-decoration: none;
            color: inherit;
            transition: var(--transition);
            border: 1px solid #f5f5f5;
        }
        .similar-card:hover { transform: translateY(-5px); }

        .similar-img {
            width: 100%;
            aspect-ratio: 1/1;
            border-radius: 15px;
            object-fit: cover;
            margin-bottom: 8px;
            background: #f9f9f9;
        }
        .similar-name {
            font-size: 13px;
            font-weight: 700;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 36px;
            margin-bottom: 5px;
            color: var(--main-color);
        }
        .similar-price {
            font-size: 14px;
            font-weight: 800;
            color: var(--secondary-color);
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ */
        .view-more-card {
            flex: 0 0 140px;
            background: var(--main-color);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            text-decoration: none;
            gap: 10px;
            transition: var(--transition);
        }
        .view-more-card i {
            font-size: 24px;
            background: rgba(255,255,255,0.1);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .view-more-card span { font-weight: 700; font-size: 14px; }
        .view-more-card:hover { background: var(--secondary-color); }

        /* =========================================
           6. Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠØ© ÙˆØ§Ù„ØªÙˆØ³Øª (Footer & Toast)
           ========================================= */
        .fixed-footer {
            position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.96);
            padding: 20px 25px; display: flex; gap: 15px; box-shadow: 0 -15px 40px rgba(0,0,0,0.08); 
            z-index: 2000; backdrop-filter: blur(15px); border-radius: 30px 30px 0 0;
        }
        
        .action-btn { 
            height: 65px; border-radius: 22px; border: none; font-weight: 800; 
            font-size: 18px; cursor: pointer; transition: var(--transition); 
            display: flex; align-items: center; justify-content: center; gap: 12px;
        }
        .btn-cart { 
            flex: 2; background: var(--main-color); color: #fff; 
            box-shadow: 0 12px 25px rgba(0, 31, 63, 0.25); 
        }
        .btn-cart:hover { background: #003366; transform: translateY(-3px); }

        .btn-whatsapp { 
            flex: 1; background: #25D366; color: #fff; font-size: 28px;
            box-shadow: 0 12px 25px rgba(37, 211, 102, 0.25);
        }
        .btn-whatsapp:hover { background: #1ebe57; transform: translateY(-3px); }

        .disabled-mode {
            background: #e0e0e0 !important; color: #999 !important;
            cursor: not-allowed !important; box-shadow: none !important;
            transform: none !important;
        }

        /* Toast */
        #customToast {
            position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%);
            background: var(--main-color); color: white; padding: 16px 35px;
            border-radius: 50px; font-weight: 700; transition: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
            z-index: 3000; box-shadow: 0 15px 40px rgba(0,0,0,0.3); border: 1px solid var(--secondary-color);
        }
        #customToast.active { bottom: 120px; }

        /* Loading */
        #loader { 
            position: fixed; inset: 0; background: #fff; z-index: 9999; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
        }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--secondary-color); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

<div id="loader">
    <div class="spinner"></div>
    <p style="margin-top:15px; font-weight:700; color:var(--main-color)">Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± ÙŠØ¬Ù‡Ø² Ø·Ù„Ø¨Ùƒ...</p>
</div>

<div id="customToast">ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ âœ…</div>

<div class="container">
    <div class="top-actions-bar">
        <a href="index.html" class="back-btn-glow">
               <i class="fas fa-home"></i> Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        </a>
        <button class="top-share-btn" onclick="shareLogic()" id="shareBtn">
            <i class="fas fa-share-nodes"></i>
        </button>
    </div>

    <div id="mainContent" style="visibility: hidden;">
        <div class="gallery-wrapper" id="imageBox">
            <div class="out-of-stock-ribbon" id="stockRibbon">Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙƒÙ…ÙŠØ©</div>
            <div class="main-image-container">
                <img id="displayImg" src="" alt="Ø§Ù„Ù…Ù†ØªØ¬">
            </div>
            <div class="thumbnails-grid" id="thumbList"></div>
        </div>

        <div class="info-card">
            <div class="category-badge" id="catName">...</div>
            <h1 class="product-title" id="prodName">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø³Ù…...</h1>
            
            <div class="price-row">
                <div class="price-box">
                    <span class="price-yer" id="yerVal">0</span>
                    <span class="currency-label">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</span>
                </div>
                <div class="divider-v"></div>
                <div class="price-box">
                    <span class="price-sar" id="sarVal">0</span>
                    <span class="currency-label">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</span>
                </div>
            </div>
            
            <div id="sizesArea" style="display:none; margin-top:25px;">
                <div class="section-header"><i class="fas fa-expand-arrows-alt"></i> Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³:</div>
                <div class="sizes-flex" id="sizesContainer"></div>
            </div>
        </div>

        <div class="info-card">
            <div class="section-header"><i class="fas fa-align-right"></i> ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬:</div>
            <div id="descBox" class="desc-content"></div>
        </div>

        <div class="similar-section" id="similarSection" style="display:none;">
            <div class="section-header"><i class="fas fa-layer-group"></i> Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø¯ ØªØ¹Ø¬Ø¨Ùƒ:</div>
            <div class="similar-scroll" id="similarList">
                </div>
        </div>
    </div>
</div>

<div class="fixed-footer">
    <button id="cartActionBtn" class="action-btn btn-cart" onclick="addToCartLogic()">
        <i class="fas fa-shopping-basket"></i> Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©
    </button>
    <button id="waActionBtn" class="action-btn btn-whatsapp" onclick="orderViaWA()">
        <i class="fab fa-whatsapp"></i>
    </button>
</div>

<script>
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase
    const SB_URL = 'https://mpcuradmirhcfmwvsylt.supabase.co';
    const SB_KEY = 'sb_publishable_MJRUl3ON-d61CnFsJ-pFJA_Nbbpg_gZ';
    const _client = supabase.createClient(SB_URL, SB_KEY);

    const params = new URLSearchParams(window.location.search);
    const pId = params.get('id');
    const YER_TO_SAR = 140;

    let pObj = null;
    let sSize = null;

    // 2. Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
    async function startApp() {
        if (!pId) { window.location.href = 'index.html'; return; }
        
        try {
            const { data, error } = await _client
                .from('products')
                .select('*')
                .eq('id', pId)
                .single();

            if (error || !data) throw error;
            
            pObj = data;
            fillData();
            fetchSimilar(pObj.category, pObj.id);
            
        } catch (e) {
            console.error(e);
            document.body.innerHTML = "<div style='text-align:center; padding:100px;'> Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹. </div>";
        } finally {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('mainContent').style.visibility = 'visible';
        }
    }

    // 3. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function fillData() {
        document.getElementById('prodName').innerText = pObj.name;
        document.getElementById('catName').innerText = pObj.category || "Ù‚Ø³Ù… Ø¹Ø§Ù…";
        document.title = pObj.name + " | Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø±";
        document.getElementById('descBox').innerText = pObj.description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©.";

        // Ø§Ù„ØµÙˆØ±
        const imgs = Array.isArray(pObj.image) ? pObj.image : [pObj.image];
        document.getElementById('displayImg').src = imgs[0];
        
        if (imgs.length > 1) {
            const grid = document.getElementById('thumbList');
            grid.innerHTML = imgs.map((m, i) => `
                <div class="thumb-item ${i === 0 ? 'active' : ''}" onclick="swapImg(this, '${m}')">
                    <img src="${m}">
                </div>
            `).join('');
        }

        // Ø§Ù„Ø­Ø§Ù„Ø©
        if (pObj.out_of_stock) {
            setOutOfStockUI();
        }

        // Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ù…Ù‚Ø§Ø³Ø§Øª
        handleSizes();
        refreshPrices(pObj.price);
    }

    function handleSizes() {
        let szArr = [];
        try { szArr = typeof pObj.sizes === 'string' ? JSON.parse(pObj.sizes) : pObj.sizes; } catch(x) {}

        if (szArr && szArr.length > 0) {
            document.getElementById('sizesArea').style.display = 'block';
            document.getElementById('sizesContainer').innerHTML = szArr.map((s, i) => `
                <div class="size-pill" id="sz-${i}" onclick="pickSize(${i}, ${JSON.stringify(s).replace(/"/g, '&quot;')})">
                    <strong>${s.name}</strong>
                    <span>${Number(s.price).toLocaleString('en-US')} Ø±.ÙŠ</span>
                </div>
            `).join('');
            pickSize(0, szArr[0]);
        }
    }

    // 4. Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡Ø©
    async function fetchSimilar(cat, currentId) {
        if(!cat) return;
        
        try {
            const { data, error } = await _client
                .from('products')
                .select('id, name, price, image')
                .eq('category', cat)
                .neq('id', currentId)
                .limit(6);

            if (data && data.length > 0) {
                const list = document.getElementById('similarList');
                document.getElementById('similarSection').style.display = 'block';
                
                let html = data.map(item => {
                    const img = Array.isArray(item.image) ? item.image[0] : item.image;
                    return `
                        <a href="product.html?id=${item.id}" class="similar-card">
                            <img src="${img}" class="similar-img" alt="${item.name}">
                            <div class="similar-name">${item.name}</div>
                            <div class="similar-price">${Number(item.price).toLocaleString()} Ø±.ÙŠ</div>
                        </a>
                    `;
                }).join('');

                // Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
                html += `
                    <a href="index.html" class="view-more-card">
                        <i class="fas fa-arrow-left"></i>
                        <span>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯</span>
                    </a>
                `;

                list.innerHTML = html;
            }
        } catch (err) { console.error("Similar products error:", err); }
    }

    // 5. Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
    function setOutOfStockUI() {
        document.getElementById('imageBox').classList.add('product-out-of-stock');
        document.getElementById('stockRibbon').style.display = 'block';
        
        const cBtn = document.getElementById('cartActionBtn');
        const wBtn = document.getElementById('waActionBtn');
        
        cBtn.classList.add('disabled-mode');
        cBtn.innerHTML = '<i class="fas fa-ban"></i> Ù†ÙØ¯Øª Ø§Ù„ÙƒÙ…ÙŠØ©';
        cBtn.onclick = null;
        
        wBtn.classList.add('disabled-mode');
        wBtn.onclick = null;
    }

    function refreshPrices(val) {
        const y = Number(val);
        const s = Math.ceil(y / YER_TO_SAR);
        document.getElementById('yerVal').innerText = y.toLocaleString('en-US');
        document.getElementById('sarVal').innerText = s.toLocaleString('en-US');
    }

    function pickSize(idx, obj) {
        if(pObj.out_of_stock) return;
        sSize = obj;
        document.querySelectorAll('.size-pill').forEach(p => p.classList.remove('active'));
        document.getElementById('sz-' + idx).classList.add('active');
        refreshPrices(obj.price);
    }

    function swapImg(el, src) {
        document.getElementById('displayImg').src = src;
        document.querySelectorAll('.thumb-item').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
    }

    // Ù…Ø´Ø§Ø±ÙƒØ© Ø°ÙƒÙŠØ©
    async function shareLogic() {
        const title = pObj.name;
        const text = `Ù…ØªØ¬Ø± Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø± ÙŠÙ‚Ø¯Ù… Ù„ÙƒÙ…:\nğŸŒŸ *${pObj.name}*\nğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${document.getElementById('yerVal').innerText} Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ\n\nØªÙØ¶Ù„ Ø¨Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø±Ø§Ø¨Ø· Ù„ØªÙØ§ØµÙŠÙ„ Ø£ÙƒØ«Ø±:\n`;
        const url = window.location.href;

        if (navigator.share) {
            try { await navigator.share({ title, text, url }); } catch (e) {}
        } else {
            navigator.clipboard.writeText(text + url);
            triggerToast("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ø³Ù…Ù‡ âœ…");
        }
    }

    function addToCartLogic() {
        if(pObj.out_of_stock) return;

        let cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const newItem = {
            id: pObj.id,
            name: pObj.name,
            price: sSize ? sSize.price : pObj.price,
            qty: 1,
            sizeName: sSize ? sSize.name : null,
            image: Array.isArray(pObj.image) ? pObj.image[0] : pObj.image
        };
        
        cart.push(newItem);
        localStorage.setItem("cart", JSON.stringify(cart));
        triggerToast("Ø£Ø¶ÙŠÙ Ù„Ù€ Ø³Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­ ğŸ›’");
    }

    function orderViaWA() {
        if(pObj.out_of_stock) return;
        const sizeInfo = sSize ? ` (Ø§Ù„Ù…Ù‚Ø§Ø³: ${sSize.name})` : '';
        const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø§Ø¨Ù† Ø§Ù„Ù…Ø®ØªØ§Ø±ØŒ Ø£Ø±ÙŠØ¯ Ø·Ù„Ø¨:\nğŸ›ï¸ *${pObj.name}*${sizeInfo}\nğŸ’¸ Ø§Ù„Ø³Ø¹Ø±: *${document.getElementById('yerVal').innerText} Ø±.ÙŠ*`;
        window.open(`https://wa.me/967773266534?text=${encodeURIComponent(msg)}`);
    }

    function triggerToast(txt) {
        const toast = document.getElementById('customToast');
        toast.innerText = txt;
        toast.classList.add('active');
        setTimeout(() => toast.classList.remove('active'), 3000);
    }

    // Ø§Ù†Ø·Ù„Ø§Ù‚!
    startApp();
</script>

</body>
</html>
