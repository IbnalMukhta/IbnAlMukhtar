<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>عداد ابن المختار الاقتصادي</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@900&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #010409;
            color: white;
            font-family: 'Tajawal', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .container {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .stat-box {
            background: #0d1117;
            padding: 50px;
            border-radius: 40px;
            border: 2px solid #30363d;
            text-align: center;
            min-width: 300px;
        }
        .label {
            font-size: 1.5rem;
            color: #8b949e;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .number {
            font-size: 7rem; /* رقم ضخم */
            font-weight: 900;
            margin: 0;
            color: #FF8C00;
        }
        .live-color { color: #238636; }
        .dot {
            height: 15px; width: 15px; background: #238636;
            border-radius: 50%; animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="stat-box">
            <div class="label"><div class="dot"></div> متصل الآن</div>
            <p class="number live-color" id="live-count">0</p>
        </div>

        <div class="stat-box">
            <div class="label">إجمالي الزيارات</div>
            <p class="number" id="total-count">0</p>
        </div>
    </div>

    <script>
        // إعداد الاتصال ببياناتك
        const sb = supabase.createClient('https://ukjgzbgzzmlprnhlwgpr.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVramd6Ymd6em1scHJuaGx3Z3ByIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2NTM4NzAsImV4cCI6MjA4MTIyOTg3MH0.A-xvwqyDxwxDTeiB8nBgOwrJTPLWenYlO99nxbgobTw');

        async function updateStats() {
            try {
                // 1. جلب الإجمالي (بدون استهلاك بيانات)
                // نستخدم head:true لجلب العدد فقط بدون أي سجلات
                const { count, error: err1 } = await sb
                    .from('visits')
                    .select('*', { count: 'exact', head: true });

                if (!err1) document.getElementById('total-count').innerText = count.toLocaleString();

                // 2. جلب المتصلين الآن (فلترة سيرفر سريعة)
                const fiveMin = new Date(Date.now() - 5 * 60000).toISOString();
                const { count: liveCount, error: err2 } = await sb
                    .from('visits')
                    .select('*', { count: 'exact', head: true })
                    .gt('visited_at', fiveMin);

                if (!err2) document.getElementById('live-count').innerText = liveCount;

            } catch (e) { console.error(e); }
        }

        // تحديث كل 15 ثانية (توازن مثالي بين اللحظية وتوفير الاستهلاك)
        updateStats();
        setInterval(updateStats, 15000);
    </script>
</body>
</html>
